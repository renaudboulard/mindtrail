import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.DiEladB3.js";const k=[{id:1,title:"Foundational Relaxation & Trail Senses",duration:"10 min",slug:"session-1"},{id:2,title:"Technical Descent Mastery",duration:"12 min",slug:"session-2"},{id:3,title:"Climb Resilience & Mental Toughness",duration:"12 min",slug:"session-3"},{id:4,title:"Night Running Confidence",duration:"10 min",slug:"session-4"},{id:5,title:"Aid Station Transitions & Fueling",duration:"12 min",slug:"session-5"},{id:6,title:"DNF Prevention & Race Resilience",duration:"15 min",slug:"session-6"},{id:7,title:"Full Race Day Simulation",duration:"15 min",slug:"session-7"},{id:8,title:"Bonus: Race Week Quick Protocol",duration:"8 min",slug:"bonus"}];function P(){const[y,b]=r.useState(()=>typeof window<"u"&&localStorage.getItem("mindtrail_email")||""),[n,j]=r.useState(null),[a,o]=r.useState(!1),[x,d]=r.useState(0),[c,w]=r.useState(0),[u,v]=r.useState(null),[h,g]=r.useState(!1),[m,f]=r.useState(null),l=r.useRef(null);r.useEffect(()=>{const e=s=>{const i=s.detail;i?.email&&b(i.email)};return window.addEventListener("mindtrail:auth",e),()=>window.removeEventListener("mindtrail:auth",e)},[]),r.useEffect(()=>{const e=l.current;if(!e)return;const s=()=>{e.duration&&(d(e.currentTime/e.duration*100),w(e.duration))},i=()=>{o(!1),d(0)};return e.addEventListener("timeupdate",s),e.addEventListener("ended",i),()=>{e.removeEventListener("timeupdate",s),e.removeEventListener("ended",i)}},[u]);const N=async e=>{j(e),g(!0),f(null),o(!1),d(0);try{const s=await fetch("/api/get-audio-url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:y,sessionSlug:e.slug})}),i=await s.json();if(!s.ok)throw new Error(i.error||"Failed to load audio");v(i.url)}catch(s){f(s instanceof Error?s.message:"Failed to load audio")}finally{g(!1)}},S=()=>{const e=l.current;e&&(a?e.pause():e.play(),o(!a))},E=e=>{const s=l.current;if(!s||!s.duration)return;const i=e.currentTarget.getBoundingClientRect(),C=(e.clientX-i.left)/i.width;s.currentTime=C*s.duration},p=e=>{const s=Math.floor(e/60),i=Math.floor(e%60);return`${s}:${i.toString().padStart(2,"0")}`};return t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Your Sessions"}),t.jsx("div",{className:"grid gap-3 mb-8",children:k.map(e=>t.jsxs("button",{onClick:()=>N(e),className:`w-full text-left p-4 rounded-xl border transition flex items-center gap-4 ${n?.id===e.id?"border-emerald-500 bg-emerald-50":"border-gray-200 bg-white hover:border-emerald-300"}`,children:[t.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center text-sm font-bold shrink-0 ${n?.id===e.id?"bg-emerald-500 text-white":"bg-gray-100 text-gray-600"}`,children:e.id<=7?e.id:"â˜…"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:e.title}),t.jsx("p",{className:"text-gray-400 text-xs",children:e.duration})]}),n?.id===e.id&&a&&t.jsx("div",{className:"flex gap-0.5 items-end h-4",children:[1,2,3].map(s=>t.jsx("div",{className:"w-1 bg-emerald-500 rounded-full animate-pulse",style:{height:`${8+s*4}px`,animationDelay:`${s*.15}s`}},s))})]},e.id))}),n&&t.jsxs("div",{className:"sticky bottom-4 bg-white rounded-2xl shadow-xl border border-gray-200 p-4",children:[u&&t.jsx("audio",{ref:l,src:u,preload:"metadata"}),m&&t.jsx("p",{className:"text-red-500 text-sm mb-3",children:m}),t.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[t.jsx("p",{className:"text-sm font-semibold text-gray-900 flex-1",children:n.title}),t.jsx("span",{className:"text-xs text-gray-400",children:c?`${p(x/100*c)} / ${p(c)}`:n.duration})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:S,disabled:h||!!m,className:"w-10 h-10 rounded-full bg-emerald-500 hover:bg-emerald-600 disabled:bg-gray-300 transition flex items-center justify-center shrink-0",children:h?t.jsxs("svg",{className:"w-4 h-4 text-white animate-spin",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):a?t.jsxs("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("rect",{x:"6",y:"4",width:"4",height:"16"}),t.jsx("rect",{x:"14",y:"4",width:"4",height:"16"})]}):t.jsx("svg",{className:"w-4 h-4 text-white ml-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:t.jsx("polygon",{points:"5,3 19,12 5,21"})})}),t.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full cursor-pointer group",onClick:E,children:t.jsx("div",{className:"h-full bg-emerald-500 rounded-full relative",style:{width:`${x}%`},children:t.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-emerald-600 rounded-full opacity-0 group-hover:opacity-100 transition"})})})]})]})]})}export{P as default};
